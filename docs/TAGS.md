# The Tagging System

Tags are the core mechanism in `pycaps` for applying conditional styling and logic. Think of them as dynamic CSS classes that you can apply to words, lines, and segments.

## What are Tags?

A tag is simply a label (e.g., `highlight`, `first-word-in-line`) attached to an element. This allows you to:
1.  **Style elements in CSS**: Target tagged elements with precision (e.g., `.word.highlight { color: yellow; }`).
2.  **Trigger animations or effects**: Apply logic only to elements that have (or don't have) a specific tag.

There are two kinds of tags: **Structure Tags** and **Semantic Tags**.

## 1. Structure Tags

Structure tags are applied **automatically** by `pycaps` based on an element's position within the document. They describe *where* an element is. You don't need to configure them.

### Built-in Structure Tags

Here is a complete list of the tags that `pycaps` automatically generates:

**Word-level Tags:**
-   `first-word-in-document`
-   `first-word-in-segment`
-   `first-word-in-line`
-   `last-word-in-document`
-   `last-word-in-segment`
-   `last-word-in-line`

**Line-level Tags:**
-   `first-line-in-document`
-   `first-line-in-segment`
-   `last-line-in-document`
-   `last-line-in-segment`

**Segment-level Tags:**
-   `first-segment-in-document`
-   `last-segment-in-document`

**Special Tags:**
-   `emoji-for-segment`: Applied to the word that holds the emoji generated by the `emoji_in_segment` effect.

## 2. Semantic Tags

Semantic tags are applied based on the **content or meaning** of the words. You define the rules for applying these tags.

You can add semantic tags using `tagger_rules` in your JSON config or by using the `SemanticTagger` in Python. There are three rule types:

1.  **`wordlist`**: Tags a word if it appears in a specified list of words.
2.  **`regex`**: Tags words that match a regular expression pattern.
3.  **`ai`**: Uses an LLM to tag words based on a natural language prompt (e.g., "words related to finance"). **Requires an API Key.**

### Example: Using Tags in CSS

Tags are exposed as CSS classes. You can combine them for powerful selections.

```css
/* Make the first word of every line pop */
.word.first-word-in-line {
  font-weight: bold;
  color: #5eead4;
}

/* Style words tagged with our custom 'brand-name' tag */
.word.brand-name {
  background-color: blue;
  color: white;
  padding: 2px 8px;
  border-radius: 5px;
}
```

## 3. Tag Conditions

When adding animations or effects, you often want to target specific elements. `TagCondition` allows you to create complex logical queries based on tags.

In JSON configuration, you write these conditions as a string:

```json
{
  "animations": [
    {
      "type": "pop_in",
      "when": "narration-starts",
      "what": "word",
      "tag_condition": "highlight and not first-word-in-line"
    }
  ]
}
```

In Python, you use the `TagConditionFactory`:

```python
from pycaps.tag import TagConditionFactory, BuiltinTag, Tag

# Create a condition programmatically
condition = TagConditionFactory.AND(
    TagConditionFactory.HAS(Tag("highlight")),
    TagConditionFactory.NOT(BuiltinTag.FIRST_WORD_IN_LINE)
)

# You can also parse a string, just like in the JSON
condition_from_string = TagConditionFactory.parse("highlight and not first-word-in-line")
```

The supported operators are `and`, `or`, and `not`.